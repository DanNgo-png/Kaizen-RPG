<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Flexible - Kaizen RPG</title>
</head>

<body>
  <div class="flexible-container">
    <!-- Header -->
    <div class="flex-header">
      <h2><i class="fa-solid fa-water"></i> Flow State Timer</h2>

      <div class="header-controls">

        <!-- Ratio Selector -->
        <div class="selector-wrapper">
          <button id="ratio-trigger" class="selector-trigger">
            <div style="display: flex; align-items: center; gap: 8px;">
              <i class="fa-solid fa-scale-balanced"></i>
              <span id="ratio-display">3:1 Standard</span>
            </div>
            <i class="fa-solid fa-chevron-down chevron"></i>
          </button>

          <div id="ratio-menu" class="selector-menu">
            <button class="selector-opt ratio-opt" data-value="2.0" data-label="2:1 Relaxed">
              <span class="opt-bold">2:1</span> Relaxed
            </button>
            <button class="selector-opt ratio-opt selected" data-value="3.0" data-label="3:1 Standard">
              <span class="opt-bold">3:1</span> Standard
            </button>
            <button class="selector-opt ratio-opt" data-value="4.0" data-label="4:1 Industrious">
              <span class="opt-bold">4:1</span> Industrious
            </button>
            <button class="selector-opt ratio-opt" data-value="5.0" data-label="5:1 Hard Mode">
              <span class="opt-bold">5:1</span> Hard Mode
            </button>
            <button class="selector-opt ratio-opt" data-value="6.0" data-label="6:1 Grinding">
              <span class="opt-bold">6:1</span> Grinding
            </button>
          </div>
        </div>

        <!-- Tag Selector -->
        <div class="selector-wrapper">
          <button id="tag-trigger" class="selector-trigger">
            <div style="display: flex; align-items: center; gap: 8px;">
              <i class="fa-solid fa-tag"></i>
              <span id="tag-display">No Tag</span>
            </div>
            <i class="fa-solid fa-chevron-down chevron"></i>
          </button>

          <div id="tag-menu" class="selector-menu">
            <!-- List Container -->
            <div id="tag-list">
              <!-- Populated by JS -->
            </div>
            <!-- Manage Button (Replaces Input) -->
            <div class="menu-footer-action">
              <button id="btn-open-manage-tags" class="btn-block-text">
                <i class="fa-solid fa-gear"></i> Manage Tags
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Cards -->
    <div class="flex-cards-row">
      <!-- Focus Card -->
      <div id="card-focus" class="flex-card">
        <div class="card-icon"><i class="fa-solid fa-brain"></i></div>
        <div class="card-label">Focus</div>
        <div class="card-time" id="disp-focus">0:00:00</div>
      </div>

      <!-- Balance Card -->
      <div id="card-balance" class="flex-card center-card">
        <div class="card-label">Balance</div>
        <div class="card-time" id="disp-balance">+0:00</div>
        <div class="balance-sub" id="msg-balance">Bank is empty</div>
      </div>

      <!-- Break Card -->
      <div id="card-break" class="flex-card">
        <div class="card-icon"><i class="fa-solid fa-mug-hot"></i></div>
        <div class="card-label">Break</div>
        <div class="card-time" id="disp-break">0:00:00</div>
      </div>
    </div>

    <!-- Controls -->
    <div class="flex-controls">
      <!-- Log Exception -->
      <button id="btn-log-exception" class="btn-flex-icon" title="Log Exception / Manual Adjustment">
        <i class="fa-solid fa-pen-to-square"></i>
      </button>

      <!-- Main Action -->
      <button id="btn-flex-main" class="btn-flex-primary">
        <i class="fa-solid fa-play"></i> Start Focus
      </button>

      <!-- Conclude -->
      <button id="btn-flex-finish" class="btn-flex-secondary hidden">
        <i class="fa-solid fa-flag-checkered"></i> Conclude
      </button>
    </div>

    <div class="session-log">
      <span>Session Started: <span id="session-start-time">--:--</span></span>
    </div>
  </div>

  <!-- ================= MODALS ================= -->

  <!-- 1. Manage Tags Modal -->
  <div id="manage-tags-modal" class="modal-overlay hidden">
    <div class="focus-flexible-modal-content large-modal">
      <div class="modal-header">
        <h3>Manage Tags</h3>
        <button id="btn-close-manage-tags" class="btn-icon-sm"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div class="manage-layout">
        <!-- Left: Current Tags -->
        <div class="manage-sidebar">
          <h4 class="section-title current-tags">Current Tags</h4>
          <div id="manage-tag-list" class="manage-list-container">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Right: Add / Edit Form -->
        <div class="manage-form-area">
          <h4 id="manage-form-title" class="section-title add-new-tag">Add New Tag</h4>

          <div class="form-group">
            <label>Tag Name</label>
            <input type="text" id="manage-tag-name" placeholder="e.g. Deep Work">
          </div>

          <div class="form-group">
            <label>Color</label>
            <button id="btn-open-color-picker" class="color-preview-btn">
              <span id="color-preview-dot" class="preview-dot"></span>
              <span id="color-preview-text">#10b981</span>
            </button>
          </div>

          <div class="form-actions">
            <button id="btn-cancel-edit-tag" class="btn-flex-secondary hidden">Cancel</button>
            <button id="btn-submit-tag" class="btn-flex-primary">Add Tag</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 2. Color Picker Overlay (Nested Modal) -->
  <div id="color-picker-overlay" class="modal-overlay hidden nested-overlay">
    <div class="focus-flexible-modal-content compact-modal">
      <h3>Pick Color</h3>

      <!-- Presets -->
      <div class="color-presets">
        <div class="color-swatch" data-color="#3b82f6" style="background: #3b82f6;"></div>
        <div class="color-swatch" data-color="#10b981" style="background: #10b981;"></div>
        <div class="color-swatch" data-color="#f59e0b" style="background: #f59e0b;"></div>
        <div class="color-swatch" data-color="#ef4444" style="background: #ef4444;"></div>
        <div class="color-swatch" data-color="#a855f7" style="background: #a855f7;"></div>
        <div class="color-swatch" data-color="#ec4899" style="background: #ec4899;"></div>
        <div class="color-swatch" data-color="#6366f1" style="background: #6366f1;"></div>
        <div class="color-swatch" data-color="#6b7280" style="background: #6b7280;"></div>
      </div>

      <!-- Opacity Slider -->
      <div class="input-row">
        <label>Opacity: <span id="opacity-val">70%</span></label>
        <input type="range" id="color-opacity" min="10" max="100" value="70">
      </div>

      <!-- Custom Hex -->
      <div class="input-row">
        <label>Hex Code</label>
        <input type="text" id="custom-hex-input" placeholder="#FFFFFF">
      </div>

      <div class="modal-actions">
        <button id="btn-cancel-color" class="btn-flex-secondary">Cancel</button>
        <button id="btn-confirm-color" class="btn-flex-primary">Select</button>
      </div>
    </div>
  </div>

  <!-- Exception Modal (Mid-Session) -->
  <div id="exception-modal" class="modal-overlay hidden">
    <div class="focus-flexible-modal-content">
      <h3><i class="fa-solid fa-clock-rotate-left"></i> Log Exception</h3>
      <p>Manually adjust current totals. Use negative numbers to remove time.</p>

      <!-- Current Stats Display -->
      <div class="current-stats-row">
        <div class="stat-item">
          <span class="stat-label">Current Focus</span>
          <span class="stat-val" id="exc-display-focus">0:00:00</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Current Break</span>
          <span class="stat-val" id="exc-display-break">0:00:00</span>
        </div>
      </div>

      <div class="input-row">
        <label>Adjust Focus (minutes)</label>
        <input id="exc-focus-input" placeholder="e.g. 10 (add) or -5 (remove)">
      </div>

      <div class="input-row">
        <label>Adjust Break (minutes)</label>
        <input id="exc-break-input" placeholder="e.g. 5 (add) or -2 (remove)">
      </div>

      <div class="modal-actions">
        <button id="btn-exc-cancel" class="btn-flex-secondary">Cancel</button>
        <button id="btn-exc-apply" class="btn-flex-primary">Apply Adjustments</button>
      </div>
    </div>
  </div>

  <!-- Conclusion Modal (End-Session Review) -->
  <div id="conclusion-modal" class="modal-overlay hidden">
    <div class="focus-flexible-modal-content">
      <h3><i class="fa-solid fa-clipboard-check"></i> Session Review</h3>
      <p>Finalize your log. Use the slider to trim excess time.</p>

      <div class="input-row">
        <label>Total Focus (Time)</label>
        <input type="text" id="conclude-focus-input" placeholder="MM:SS">
        <input type="range" id="conclude-focus-slider" min="0" step="1">
      </div>

      <div class="input-row">
        <label>Total Break (Time)</label>
        <input type="text" id="conclude-break-input" placeholder="MM:SS">
        <input type="range" id="conclude-break-slider" min="0" step="1">
      </div>

      <div class="modal-actions">
        <button id="btn-conclude-cancel" class="btn-flex-secondary">Cancel</button>
        <button id="btn-conclude-save" class="btn-flex-primary">Save Session</button>
      </div>
    </div>
  </div>

  <!-- Delete Tag Confirmation Modal -->
  <div id="delete-tag-modal" class="modal-overlay hidden">
    <div class="modal-content" style="text-align: center;">
      <div class="modal-header-icon">
        <i class="fa-solid fa-triangle-exclamation"></i>
      </div>
      <h3>Delete Tag?</h3>
      <p>Are you sure you want to delete <b id="del-tag-name-display" style="color: #fff;"></b>?<br>This action cannot be undone.</p>
      
      <div class="modal-actions" style="justify-content: center;">
        <button id="btn-cancel-delete-tag" class="btn-flex-secondary">Cancel</button>
        <button id="btn-confirm-delete-tag" class="btn-flex-primary btn-flex-danger">Delete</button>
      </div>
    </div>
  </div>
</body>

</html>